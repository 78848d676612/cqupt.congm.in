server {
	listen  80;
	server_name  ~^(.+)\.cqupt\.congm\.in$;

  resolver 114.114.114.114 8.8.8.8 valid=3600s;
	set $cqupt $1;

  if ($cqupt ~ "^www$"){
	  rewrite ^(.*)$  https://cqupt.congm.in  permanent;
  }
	location / {
		proxy_pass http://$cqupt.host.congm.in:88;
		sub_filter '</body>' '<script src="//cqupt.congm.in/common/main.js" type="text/javascript" charset="utf-8"></script></body>';
		sub_filter_once off;
	}
}
server {
	listen  80;
	server_name  jwzx.cqupt.edu.cn.cqupt.congm.in jwzx.cqupt.congm.in;
  rewrite  ^(.*)$  https://jwzx.cqupt.congm.in  permanent;
}
server {
	listen  443;
	server_name  jwzx.cqupt.congm.in;

  ssl on;
  ssl_certificate ssl/cqupt.congm.in.crt;
  ssl_certificate_key ssl/cqupt.congm.in.key;
  ssl_session_timeout 5m;
  ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
  ssl_prefer_server_ciphers on;

	location / {
		proxy_pass http://jwzx.host.congm.in:88;
		sub_filter '</body>' '<script src="//cqupt.congm.in/common/main.js" type="text/javascript" charset="utf-8"></script></body>';
		sub_filter_once off;
}